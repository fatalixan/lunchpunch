<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop Staff Management</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.33/dist/vue.global.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css" rel="stylesheet">

        <!-- FullCalendar CSS и JS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>


    
</head>
<body>
    <div id="app" class="container mx-auto p-4">
        <h1 class="text-2xl font-bold text-center mb-4">Coffee Shop Staff Management</h1>
        
        <!-- Навигация между разделами интерфейса -->
        <nav class="flex justify-around mb-4">
            <button @click="goToDashboard" class="btn-nav">Dashboard</button>
            <button @click="currentView = 'StaffSchedule'" class="btn-nav">Staff Schedule</button>
            <button @click="currentView = 'Staff'" class="btn-nav">Staff</button>
            <button @click="currentView = 'Schedule'" class="btn-nav">Schedule</button>
            <button @click="currentView = 'Reports'" class="btn-nav">Reports</button>
        </nav>
        
        <!-- Раздел Staff Schedule -->
        <div v-if="currentView === 'StaffSchedule'">
            <h2 class="text-xl font-semibold mb-2">Staff Schedule</h2>
            <form @submit.prevent="isEditing ? updateStaffSchedule() : createStaffSchedule()" class="mb-4">
                <input v-model="newJobTitle" placeholder="Job Title" class="input" required/>
                <input v-model="newRate" placeholder="Rate" type="number" step="0.01" class="input"/>
                <input v-model="newBonus" placeholder="Bonus" type="number" step="0.01" class="input"/>
                <input v-model="newDescription" placeholder="Description" class="input"/>
                <button type="submit" class="btn-primary">{{ isEditing ? 'Save Changes' : 'Add Schedule' }}</button>
                <button v-if="isEditing" @click="cancelEdit" class="btn-secondary">Cancel</button>
            </form>

            <!-- Таблица данных Staff Schedule -->
            <div class="table-container">
                <table class="min-w-full bg-white">
                    <thead class="sticky-header">
                        <tr>
                            <th class="py-2 px-4 border-b">Job Title</th>
                            <th class="py-2 px-4 border-b">Rate</th>
                            <th class="py-2 px-4 border-b">Bonus</th>
                            <th class="py-2 px-4 border-b">Description</th>
                            <th class="py-2 px-4 border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="schedule in schedules" :key="schedule.id">
                            <td class="py-2 px-4 border-b">{{ schedule.job_title }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.rate }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.bonus }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.description }}</td>
                            <td class="py-2 px-4 border-b">
                                <button @click="editStaffSchedule(schedule)" class="text-blue-500">Update</button>
                                <button @click="deleteStaffSchedule(schedule.id)" class="text-red-500 ml-2">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Раздел Staff -->
        <div v-if="currentView === 'Staff'">
            <h2 class="text-xl font-semibold mb-2">Staff</h2>
            <form @submit.prevent="isEditing ? updateStaff() : createStaff()" class="mb-4">
                <label for="job_title" class="block mb-2">Job Title</label>
                <select v-model="newStaffScheduleId" class="input mb-4" required>
                    <option disabled value="">Select Job Title</option>
                    <option v-for="schedule in staffScheduleOptions" :key="schedule.id" :value="schedule.id">
                        {{ schedule.job_title }}
                    </option>
                </select>
                <input v-model="newFullName" placeholder="Full Name" class="input" required/>
                <input v-model="newDateOfHiring" type="date" class="input"/>
                <input v-model="newStatus" placeholder="Status" class="input"/>
                <input v-model="newStaffDescription" placeholder="Description" class="input"/>
                <button type="submit" class="btn-primary">{{ isEditing ? 'Save Changes' : 'Add Staff' }}</button>
                <button v-if="isEditing" @click="cancelEdit" class="btn-secondary">Cancel</button>
            </form>

            <!-- Таблица данных Staff -->
            <div class="table-container">
                <table class="min-w-full bg-white">
                    <thead class="sticky-header">
                        <tr>
                            <th class="py-2 px-4 border-b">Full Name</th>
                            <th class="py-2 px-4 border-b">Job Title</th>
                            <th class="py-2 px-4 border-b">Date of Hiring</th>
                            <th class="py-2 px-4 border-b">Status</th>
                            <th class="py-2 px-4 border-b">Description</th>
                            <th class="py-2 px-4 border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="staff in staffList" :key="staff.id">
                            <td class="py-2 px-4 border-b">{{ staff.full_name }}</td>
                            <td class="py-2 px-4 border-b">{{ getJobTitle(staff.staff_schedule_id) }}</td>
                            <td class="py-2 px-4 border-b">{{ staff.date_of_hiring }}</td>
                            <td class="py-2 px-4 border-b">{{ staff.status }}</td>
                            <td class="py-2 px-4 border-b">{{ staff.description }}</td>
                            <td class="py-2 px-4 border-b">
                                <button @click="editStaff(staff)" class="text-blue-500">Update</button>
                                <button @click="deleteStaff(staff.id)" class="text-red-500 ml-2">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Раздел Schedule -->
     
        <div id="calendar" rel="calendar" class="mb-4" v-show="currentView === 'Schedule'"></div>
        
        <div v-if="currentView === 'Schedule'">
            
            <h2 class="text-xl font-semibold mb-2">Schedule</h2>
            <form @submit.prevent="isEditing ? updateSchedule() : createSchedule()" class="mb-4">
                <label for="staff" class="block mb-2">Staff</label>
                <select v-model="newStaffId" class="input mb-4" required>
                    <option disabled value="">Select Staff</option>
                    <option v-for="staff in staffOptions" :key="staff.id" :value="staff.id">
                        {{ staff.full_name }}
                    </option>
                </select>
                <label for="coffee_shop" class="block mb-2">Coffee Shop</label>
                <select v-model="newCoffeeShopId" class="input mb-4" required>
                    <option disabled value="">Select Coffee Shop</option>
                    <option v-for="shop in coffeeShopOptions" :key="shop.id" :value="shop.id">
                        {{ shop.name }}
                    </option>
                </select>
                <input v-model="newDate" type="date" class="input" required/>
                <input v-model="newShiftStart" placeholder="Shift Start" type="time" class="input" required/>
                <input v-model="newShiftEnd" placeholder="Shift End" type="time" class="input" required/>
                <input v-model="newRevenue" placeholder="Revenue" type="number" step="0.01" class="input"/>
                <input v-model="newDescription" placeholder="Description" class="input"/>
                <button type="submit" class="btn-primary">{{ isEditing ? 'Save Changes' : 'Add Schedule' }}</button>
                <button v-if="isEditing" @click="cancelEdit" class="btn-secondary">Cancel</button>
            </form>

            <!-- Таблица данных Schedule -->
            <div class="table-container">
                <table class="min-w-full bg-white">
                    <thead class="sticky-header">
                        <tr>
                            <th class="py-2 px-4 border-b">Date</th>
                            <th class="py-2 px-4 border-b">Full Name</th>
                            <th class="py-2 px-4 border-b">Coffee Shop</th>
                            <th class="py-2 px-4 border-b">Shift Start</th>
                            <th class="py-2 px-4 border-b">Shift End</th>
                            <th class="py-2 px-4 border-b">Revenue</th>
                            <th class="py-2 px-4 border-b">Description</th>
                            <th class="py-2 px-4 border-b">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="schedule in scheduleList" :key="schedule.id" :class="{'bg-red-100': isToday(schedule.date)}">
                            <td class="py-2 px-4 border-b">{{ schedule.date }}</td>
                            <td class="py-2 px-4 border-b">{{ getFullName(schedule.staff_id) }}</td>
                            <!-- Ячейка Coffee Shop с динамическим классом цвета -->
                             <td :class="getCoffeeShopClass(schedule.coffee_shop_id)" class="py-2 px-4 border-b">
                             {{ getCoffeeShopName(schedule.coffee_shop_id) }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.shift_start }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.shift_end }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.revenue }}</td>
                            <td class="py-2 px-4 border-b">{{ schedule.description }}</td>
                            <td class="py-2 px-4 border-b">
                                <button @click="editSchedule(schedule)" class="text-blue-500">Update</button>
                                <button @click="deleteSchedule(schedule.id)" class="text-red-500 ml-2">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    
<!-- Выбор диапазона дат для фильтрации Reports -->
<div v-if="currentView === 'Reports'" class="mb-4">
    <label class="block font-semibold mb-2">Select Date Range</label>
    <div class="flex space-x-2">
        <div>
            <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
            <input type="date" v-model="startDate" @change="fetchReports" class="input">
        </div>
        <div>
            <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>
            <input type="date" v-model="endDate" @change="fetchReports" class="input">
        </div>
    </div>
</div>

    <div v-if="currentView === 'Reports'">
            <h2 class="text-xl font-semibold mb-2">Reports</h2>
            <table class="min-w-full bg-white">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b">Full Name</th>
                        <th class="py-2 px-4 border-b">Coffee Shop</th>
                        <th class="py-2 px-4 border-b">Total Hours Worked</th>
                        <th class="py-2 px-4 border-b">Total Revenue</th>
                        <th class="py-2 px-4 border-b">Salary</th>
                        <th class="py-2 px-4 border-b">Bonus</th>
                        <th class="py-2 px-4 border-b">Total Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="report in reportData" :key="report.staff_id">
                        <td class="py-2 px-4 border-b">{{ getFullName(report.staff_id) }}</td>
                        <td class="py-2 px-4 border-b">{{ getCoffeeShopName(report.coffee_shop_id) }}</td>
                        <td class="py-2 px-4 border-b">{{ report.totalHoursWorked }}</td>
                        <td class="py-2 px-4 border-b">{{ report.totalRevenue }}</td>
                        <td class="py-2 px-4 border-b">{{ report.salary }}</td>
                        <td class="py-2 px-4 border-b">{{ report.bonus }}</td>
                        <td class="py-2 px-4 border-b">{{ report.totalAmount }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>





    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                const currentDate = new Date();
                const year = currentDate.getFullYear();
                const month = (currentDate.getMonth() + 1).toString().padStart(2, '0'); // Приводим месяц к формату MM
                const day = currentDate.getDate().toString().padStart(2, '0'); // Приводим день к формату DD

                 // Формируем дату в формате YYYY-MM-DD
                const startDate = `${year}-${month}-01`; // Первое число текущего месяца
                const endDate = `${year}-${month}-${day}`; // Текущая дата


                return {
                    currentView: 'Schedule',
                    startDate: startDate, 
                    endDate: endDate,
                    isEditing: false,
                    editId: null,
                    newJobTitle: '',
                    newRate: '',
                    newBonus: '',
                    newDescription: '',
                    newStaffScheduleId: '',
                    newFullName: '',
                    newDateOfHiring: '',
                    newStatus: '',
                    newStaffDescription: '',
                    newStaffId: '',
                    newCoffeeShopId: '',
                    newDate: '',
                    newShiftStart: '',
                    newShiftEnd: '',
                    newRevenue: 0,
                    reportData: [],
                    schedules: [],
                    staffList: [],
                    scheduleList: [],
                    staffScheduleOptions: [],
                    staffOptions: [],
                    scheduleEvents: [], 
                    coffeeShopOptions: []
                };
            },
            methods: {
                fetchStaffSchedule() {
                    fetch('api.php?entity=staff_schedule')
                        .then(response => response.json())
                        .then(data => { this.schedules = data; });
                },
                fetchStaff() {
                    fetch('api.php?entity=staff')
                        .then(response => response.json())
                        .then(data => { this.staffList = data; });
                },
                fetchSchedule() {
                    fetch('api.php?entity=schedule')
                        .then(response => response.json())
                        .then(data => { 
                            this.scheduleList = this.scheduleList = data.sort((a, b) => new Date(b.date) - new Date(a.date));   
                        
                        });

                        
                },
                fetchStaffScheduleOptions() {
                    fetch('api.php?entity=staff_schedule')
                        .then(response => response.json())
                        .then(data => { this.staffScheduleOptions = data; });
                },
                fetchStaffOptions() {
                    fetch('api.php?entity=staff')
                        .then(response => response.json())
                        .then(data => { this.staffOptions = data; });
                },
                fetchCoffeeShopOptions() {
                    fetch('api.php?entity=coffee_shop')
                        .then(response => response.json())
                        .then(data => { this.coffeeShopOptions = data; }); 
                },
                getJobTitle(staffScheduleId) {
                    const schedule = this.staffScheduleOptions.find(s => s.id === staffScheduleId);
                    return schedule ? schedule.job_title : '';
                },
                getFullName(staffId) {
                    const staff = this.staffOptions.find(s => s.id === staffId);
                    return staff ? staff.full_name : '';
                },
                getCoffeeShopName(coffeeShopId) {
                    const shop = this.coffeeShopOptions.find(s => s.id === coffeeShopId);
                    return shop ? shop.name : '';
                },
                createStaffSchedule() {
                    fetch('api.php?entity=staff_schedule', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            job_title: this.newJobTitle,
                            rate: this.newRate,
                            bonus: this.newBonus,
                            description: this.newDescription
                        })
                    }).then(() => {
                        this.fetchStaffSchedule(); 
                        this.fetchStaffScheduleOptions(); 
                        this.resetForm();
                    });
                },
                createStaff() {
                    fetch('api.php?entity=staff', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            staff_schedule_id: this.newStaffScheduleId,
                            full_name: this.newFullName,
                            date_of_hiring: this.newDateOfHiring,
                            status: this.newStatus,
                            description: this.newStaffDescription
                        })
                    }).then(() => {
                        this.fetchStaff();
                        this.fetchStaffOptions();
                        this.resetForm();
                    });
                },
                createSchedule() {
                    fetch('api.php?entity=schedule', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            staff_id: this.newStaffId,
                            coffee_shop_id: this.newCoffeeShopId,
                            date: this.newDate,
                            shift_start: this.newShiftStart,
                            shift_end: this.newShiftEnd,
                            revenue: this.newRevenue,
                            description: this.newDescription
                        })
                    }).then(() => {
                        this.fetchSchedule();
                        this.resetForm();
                    });
                },
                editStaffSchedule(schedule) {
                    this.isEditing = true;
                    this.editId = schedule.id;
                    this.newJobTitle = schedule.job_title;
                    this.newRate = schedule.rate;
                    this.newBonus = schedule.bonus;
                    this.newDescription = schedule.description;
                },
                editStaff(staff) {
                    this.isEditing = true;
                    this.editId = staff.id;
                    this.newStaffScheduleId = staff.staff_schedule_id;
                    this.newFullName = staff.full_name;
                    this.newDateOfHiring = staff.date_of_hiring;
                    this.newStatus = staff.status;
                    this.newStaffDescription = staff.description;
                },
                editSchedule(schedule) {
                    this.isEditing = true;
                    this.editId = schedule.id;
                    this.newStaffId = schedule.staff_id;
                    this.newCoffeeShopId = schedule.coffee_shop_id;
                    this.newDate = schedule.date;
                    this.newShiftStart = schedule.shift_start;
                    this.newShiftEnd = schedule.shift_end;
                    this.newRevenue = schedule.revenue;
                    this.newDescription = schedule.description;
                },
                updateStaffSchedule() {
                    fetch(`api.php?entity=staff_schedule&id=${this.editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            job_title: this.newJobTitle,
                            rate: this.newRate,
                            bonus: this.newBonus,
                            description: this.newDescription
                        })
                    }).then(() => {
                        this.fetchStaffSchedule();
                        this.fetchStaffScheduleOptions();
                        this.resetForm();
                    });
                },
                updateStaff() {
                    fetch(`api.php?entity=staff&id=${this.editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            staff_schedule_id: this.newStaffScheduleId,
                            full_name: this.newFullName,
                            date_of_hiring: this.newDateOfHiring,
                            status: this.newStatus,
                            description: this.newStaffDescription
                        })
                    }).then(() => {
                        this.fetchStaff();
                        this.fetchStaffOptions();
                        this.resetForm();
                    });
                },
                updateSchedule() {
                    fetch(`api.php?entity=schedule&id=${this.editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            staff_id: this.newStaffId,
                            coffee_shop_id: this.newCoffeeShopId,
                            date: this.newDate,
                            shift_start: this.newShiftStart,
                            shift_end: this.newShiftEnd,
                            revenue: this.newRevenue,
                            description: this.newDescription
                        })
                    }).then(() => {
                        this.fetchSchedule();
                        this.resetForm();
                    });
                },
                deleteStaffSchedule(id) {
                    fetch(`api.php?entity=staff_schedule&id=${id}`, { method: 'DELETE' })
                        .then(() => {
                            this.fetchStaffSchedule();
                            this.fetchStaffScheduleOptions();
                        });
                },
                deleteStaff(id) {
                    fetch(`api.php?entity=staff&id=${id}`, { method: 'DELETE' })
                        .then(() => {
                            this.fetchStaff();
                            this.fetchStaffOptions();
                        });
                },
                deleteSchedule(id) {
                    fetch(`api.php?entity=schedule&id=${id}`, { method: 'DELETE' })
                        .then(() => this.fetchSchedule());
                },
                resetForm() {
                    this.isEditing = false;
                    this.editId = null;
                    this.newJobTitle = '';
                    this.newRate = '';
                    this.newBonus = '';
                    this.newDescription = '';
                    this.newStaffScheduleId = '';
                    this.newFullName = '';
                    this.newDateOfHiring = '';
                    this.newStatus = '';
                    this.newStaffDescription = '';
                    this.newStaffId = '';
                    this.newCoffeeShopId = '';
                    this.newDate = '';
                    this.newShiftStart = '';
                    this.newShiftEnd = '';
                    this.newRevenue = 0;
                },
                cancelEdit() {
                    this.resetForm();
                },

                getCoffeeShopClass(coffeeShopId) {
                // Присвоение разных классов в зависимости от ID Coffee Shop
                const id = Number(coffeeShopId);
                switch (id) {
                    case 1:
                        return 'bg-red-100 !important'; // Красный для Coffee Shop с ID 1
                    case 2:
                        return 'bg-green-100 !important'; // Зеленый для ID 2
                    case 3:
                        return 'text-blue-400'; // Синий для ID 3
                    default:
                        return 'text-gray-400'; // Серый для остальных
                    }
                },

                isToday(date) {
                    const today = new Date();
                    const recordDate = new Date(date);
                    return (
                        recordDate.getDate() === today.getDate() &&
                        recordDate.getMonth() === today.getMonth() &&
                        recordDate.getFullYear() === today.getFullYear()
                    );
                },

                fetchReports() {
                    Promise.all([
                        fetch('api.php?entity=staff').then(response => response.json()),
                        fetch('api.php?entity=staff_schedule').then(response => response.json()),
                        fetch('api.php?entity=schedule').then(response => response.json())
                    ]).then(([staffData, staffScheduleData, scheduleData]) => {
                        const scheduleRates = {};
                        staffScheduleData.forEach(schedule => {
                            scheduleRates[schedule.id] = {
                                rate: parseFloat(schedule.rate) || 0,    // Приводим к числу
                                bonus: parseFloat(schedule.bonus) || 0   // Приводим к числу
                                };
                            });

                            // Фильтруем данные по диапазону дат
                                const filteredData = scheduleData.filter(record => {
                                const recordDate = new Date(record.date);
                                return recordDate >= new Date(this.startDate) && recordDate <= new Date(this.endDate);
        });

                            this.generateReport(filteredData, staffData, scheduleRates);
                        });

                        
                },
                
                     generateReport(scheduleData, staffData, scheduleRates) {
                        const reports = {};
                        scheduleData.forEach(record => {
                            const staffId = record.staff_id;
                            const coffeeShopId = record.coffee_shop_id;
                            const staffKey = `${staffId}-${coffeeShopId}`;
                            
                            if (!reports[staffKey]) {
                                reports[staffKey] = {
                                    staff_id: staffId,
                                    coffee_shop_id: coffeeShopId,
                                    totalHoursWorked: 0, 
                                    totalRevenue: 0,
                                    salary: 0,
                                    bonus: 0,
                                    totalAmount: 0
                                };
                            }
                            // Рассчитываем количество отработанных часов
                            const hoursWorked = this.calculateHours(record.shift_start, record.shift_end);
                            reports[staffKey].totalHoursWorked += hoursWorked;
                            reports[staffKey].totalRevenue += parseFloat(record.revenue) || 0; // Приводим выручку к числу
                            });
                            // Вычисляем зарплату и бонусы на основе totalHoursWorked и totalRevenue
                            staffData.forEach(staff => {
                                const scheduleInfo = scheduleRates[staff.staff_schedule_id];
                                const rate = scheduleInfo ? parseFloat(scheduleInfo.rate) || 0 : 0;
                                const bonusPercentage = scheduleInfo ? parseFloat(scheduleInfo.bonus) || 0 : 0;
                                
                                for (const key in reports) {
                                    if (reports[key].staff_id === staff.id) {
                                        const totalHours = reports[key].totalHoursWorked;
                                        const totalRevenue = reports[key].totalRevenue;
                                        
                                        // Приведение к числу для расчета salary и bonus
                                        reports[key].salary = totalHours * rate;
                                        reports[key].bonus = (totalRevenue * bonusPercentage) / 100;
                                        reports[key].totalAmount = reports[key].salary + reports[key].bonus;
                                    }
                                }
                            });
                            this.reportData = Object.values(reports);
                    },

                getCoffeeShopName(coffeeShopId) {
                    const shop = this.coffeeShopOptions.find(s => s.id === coffeeShopId);
                    return shop ? shop.name : '';
                },
                getFullName(staffId) {
                const staff = this.staffOptions.find(s => s.id === staffId);
                    return staff ? staff.full_name : '';
                },

                goToDashboard() {
                    window.location.href = 'dashboard.html';
                },

                initializeCalendar() {
                    // Инициализируем календарь
                    const calendarEl = document.getElementById('calendar');
                    if (this.calendar) {
                        this.calendar.destroy();
                    }
                    const calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        firstDay: 1,
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridMonth,timeGridWeek,timeGridDay'
                        },
                        events: (info, successCallback, failureCallback) => {
                            // Загружаем данные из Schedule и отображаем в календаре
                            fetch('api.php?entity=schedule')
                            .then(response => response.json())
                            .then(data => {
                                const events = data.map(record => ({
                                    title: this.getFullName(record.staff_id), // Имя сотрудника
                                    start: record.date + 'T' + record.shift_start,
                                    end: record.date + 'T' + record.shift_end,
                                    className: this.getCoffeeShopClass(record.coffee_shop_id) 
                                }));
                                successCallback(events);
                            })
                            .catch(error => {
                                console.error('Error loading schedule:', error);
                                failureCallback(error);
                            });
                        },

                        eventTimeFormat: { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            hour12: false  // Используем 24-часовой формат
                            },
                            // Формат времени для временной шкалы (например, в timeGrid)
                        slotLabelFormat: {
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: false
                        }
                        
                    });

                    if (this.currentView === 'Schedule') {
                        calendar.render();
                    }
                    
                },


                calculateHours(shiftStart, shiftEnd) {
                    const [startHour, startMinute] = shiftStart.split(':').map(Number);
                    const [endHour, endMinute] = shiftEnd.split(':').map(Number);
                    
                    // Рассчитываем общее количество минут для начала и конца
                    const startTotalMinutes = startHour * 60 + startMinute;
                    const endTotalMinutes = endHour * 60 + endMinute;
                    // Вычисляем разницу в минутах и преобразуем в часы
                    const minutesWorked = endTotalMinutes - startTotalMinutes;
                    return minutesWorked / 60; // Преобразование в часы
                },

            },

            mounted() {
                this.fetchStaffSchedule();
                this.fetchStaff();
                this.fetchSchedule();
                this.fetchStaffScheduleOptions();
                this.fetchStaffOptions();
                this.fetchCoffeeShopOptions();
                this.fetchReports();
                this.initializeCalendar();
                
            }
        }).mount('#app');
    </script>

    <style>
        .input { padding: 0.5rem; border: 1px solid #ddd; border-radius: 8px; margin-right: 0.5rem; }
        .btn-primary { padding: 0.5rem 1rem; background-color: #1D4ED8; color: white; border-radius: 8px; cursor: pointer; }
        .btn-secondary { padding: 0.5rem 1rem; background-color: #6B7280; color: white; border-radius: 8px; cursor: pointer; }
        .btn-nav { padding: 0.5rem 1rem; border: 2px solid #1F2937; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .table-container { max-height: 400px; overflow-y: auto; }
        .sticky-header { position: sticky; top: 0; background-color: white; z-index: 1; }

        .coffee-shop-1 { background-color: #e0f7fa !important; color: #000 !important; }
        .coffee-shop-2 { background-color: #ffecb3 !important; color: #000 !important; }
        .coffee-shop-3 { background-color: #ffe0b2 !important; color: #000 !important; }



    </style>
</body>
</html>
